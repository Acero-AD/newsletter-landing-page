---
// SubscribeForm.astro
// No server-side logic required here.
---

<form id="subscribe-form" class="flex flex-col space-y-2">
  <input type="email" id="email" placeholder="Enter your email" required
    class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-md placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50" />
  <button type="submit"
    class="w-full px-3 py-2 bg-white text-primary font-bold rounded-md hover:bg-purple-100 transition-colors">
    Subscribe Now
  </button>
</form>

<script>
  // Define a helper function to handle the actual subscription logic
  function subscribeUser(email) {
    return fetch('/api/subscribe', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ email })
    })
    .then(response => response.json());
  }

  // Define the form submit handler as a separate function
  function handleSubscription(e) {
    e.preventDefault();
    const email = document.getElementById('email').value;

    subscribeUser(email)
      .then(data => {
        if (data.success) {
          alert('Thank you for subscribing!');
          document.getElementById('email').value = '';
        } else {
          alert('Oops! Something went wrong.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again later.');
      });
  }

  // Attach the function to the form submit event
  document.getElementById('subscribe-form').addEventListener('submit', handleSubscription);
</script>
